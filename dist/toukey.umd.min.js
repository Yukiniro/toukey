!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("bittydash")):"function"==typeof define&&define.amd?define(["exports","bittydash"],t):t((e="undefined"!=typeof globalThis?globalThis:e||self).toukey={},e.bittydash)}(this,(function(e,t){"use strict";function r(e){return function(e){if(Array.isArray(e))return n(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||function(e,t){if(!e)return;if("string"==typeof e)return n(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);"Object"===r&&e.constructor&&(r=e.constructor.name);if("Map"===r||"Set"===r)return Array.from(e);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return n(e,t)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function n(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function o(e){switch(e){case"ctrl":return"Control";case"space":return" ";case"left":return"ArrowLeft";case"right":return"ArrowRight";case"up":return"ArrowUp";case"bottom":return"ArrowBottom";default:return e}}function i(e){return e.replace(/\s+/g,"")}function u(e){return e.toLowerCase()}var a="default",c=!0,s=[],f=new Map;function l(e){return Array.isArray(e)?u(e.map((function(e){return o(e)})).sort().join(""))===u(s.join("")):1===s.length&&u(s[0])===u(o(e))}function d(){s.length=0}function p(e){!function(e){var r=e.type,n=e.key,o=e.repeat;"keydown"!==r||o||s.push(n);"keyup"===r&&queueMicrotask((function(){t.remove(s,n)}))}(e);var n=f.get("*")||[],o=f.get(a)||[];[].concat(r(n),r(o)).forEach((function(t){var r=t.handler,n=t.keydown,o=t.keyup,u=t.key,a=t.splitValue;i(u).split(",").forEach((function(t){if(function(e,t){return e.split(t).length>1}(t,a)){var u=function(e,t){return i(e).split(t)}(t,a);l(u)&&y(r,n,o,e)}else l(t)&&y(r,n,o,e)}))}))}function y(e,t,r,n){var o=n.type;("keydown"===o&&t||"keyup"===o&&r)&&e.call(this,n)}f.set("*",[]),e.clearAll=function(){f.clear(),f.set("*",[]),a="default",d()},e.deleteScope=function(e){"*"!==e&&(f.delete(e),a="default")},e.getScope=function(){return a},e.setScope=function(e){if(!t.isString(e))throw new Error("scope must be string");a=e},e.subscribe=function(e,r,n){if(!t.isString(e))throw new Error("key must be string");if(!t.isFunction(r))throw new Error("handler must be function");var o=e,i="default",u="+",a=!1,s=!1;t.isString(n)?i=n:t.isObject(n)&&Object.keys(n).forEach((function(e){"scope"===e&&(i=n[e]),"splitValue"===e&&(u=n[e]),"keydown"===e&&(a=!0),"keyup"===e&&(s=!0)})),a||s||(a=!0),c&&(c=!1,document.addEventListener("keydown",p),document.addEventListener("keyup",p),window.addEventListener("focus",d),window.addEventListener("blur",d)),f.has(i)||f.set(i,[]);var l=f.get(i),y={handler:r,key:o,splitValue:u,keydown:a,keyup:s};return l.push(y),function(){var e=f.get(i);e&&t.remove(e,y)}},Object.defineProperty(e,"__esModule",{value:!0})}));
