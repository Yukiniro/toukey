!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):(t="undefined"!=typeof globalThis?globalThis:t||self).toukey=e()}(this,(function(){"use strict";function t(t){return function(t){if(Array.isArray(t))return e(t)}(t)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||function(t,n){if(!t)return;if("string"==typeof t)return e(t,n);var r=Object.prototype.toString.call(t).slice(8,-1);"Object"===r&&t.constructor&&(r=t.constructor.name);if("Map"===r||"Set"===r)return Array.from(t);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return e(t,n)}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function e(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}function n(t){switch(t){case"ctrl":return"Control";case"left":return"ArrowLeft";case"right":return"ArrowRight";case"up":return"ArrowUp";case"bottom":return"ArrowBottom";default:return t}}function r(t){return"string"==typeof t}function o(t,e){var n=t.indexOf(e);-1!==n&&t.splice(n,1)}function u(t){return t.replace(/\s+/g,"")}function i(t){return t.toLowerCase()}var c="default",f=!0,a=[],s=new Map;function l(t){return Array.isArray(t)?i(t.map((function(t){return n(t)})).sort().join(""))===i(a.join("")):1===a.length&&i(a[0])===n(t)}function p(e){!function(t){var e=t.type,n=t.key,r=t.repeat;"keydown"!==e||r||a.push(n);"keyup"===e&&queueMicrotask((function(){o(a,n)}))}(e);var n=s.get("*")||[],r=s.get(c)||[];[].concat(t(n),t(r)).forEach((function(t){var n=t.handler,r=t.keydown,o=t.keyup,i=t.key,c=t.splitValue;u(i).split(",").forEach((function(t){if(function(t,e){return t.split(e).length>1}(t,c)){var i=function(t,e){return u(t).split(e)}(t,c);l(i)&&y(n,r,o,e)}else l(t)&&y(n,r,o,e)}))}))}function y(t,e,n,r){var o=r.type;("keydown"===o&&e||"keyup"===o&&n)&&t.call(this,r)}return s.set("*",[]),{subscribe:function(t,e,n){if(!r(t))throw new Error("key must be string");if("function"!=typeof e)throw new Error("handler must be function");var u=t,i="default",c="+",a=!1,l=!1;r(n)?i=n:function(t){return"[object Object]"===Object.prototype.toString.call(t)}(n)&&Object.keys(n).forEach((function(t){"scope"===t&&(i=n[t]),"splitValue"===t&&(c=n[t]),"keydown"===t&&(a=!0),"keyup"===t&&(l=!0)})),a||l||(a=!0),f&&(f=!1,document.addEventListener("keydown",p),document.addEventListener("keyup",p)),s.has(i)||s.set(i,[]);var y=s.get(i),d={handler:e,key:u,splitValue:c,keydown:a,keyup:l};return y.push(d),function(){var t=s.get(i);t&&o(t,d)}},getScope:function(){return c},setScope:function(t){if(!r(t))throw new Error("scope must be string");c=t},deleteScope:function(t){"*"!==t&&(s.delete(t),c="default")}}}));
