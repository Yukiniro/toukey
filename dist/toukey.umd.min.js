!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t((e="undefined"!=typeof globalThis?globalThis:e||self).toukey={})}(this,(function(e){"use strict";function t(e){return function(e){if(Array.isArray(e))return n(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||function(e,t){if(!e)return;if("string"==typeof e)return n(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);"Object"===r&&e.constructor&&(r=e.constructor.name);if("Map"===r||"Set"===r)return Array.from(e);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return n(e,t)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function n(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function r(e){switch(e){case"ctrl":return"Control";case"space":return" ";case"left":return"ArrowLeft";case"right":return"ArrowRight";case"up":return"ArrowUp";case"bottom":return"ArrowBottom";default:return e}}function o(e){return"string"==typeof e}function u(e,t){var n=e.indexOf(t);-1!==n&&e.splice(n,1)}function i(e){return e.replace(/\s+/g,"")}function c(e){return e.toLowerCase()}var a="default",f=!0,s=[],l=new Map;function p(e){return Array.isArray(e)?c(e.map((function(e){return r(e)})).sort().join(""))===c(s.join("")):1===s.length&&c(s[0])===c(r(e))}function d(){s.length=0}function y(e){!function(e){var t=e.type,n=e.key,r=e.repeat;"keydown"!==t||r||s.push(n);"keyup"===t&&queueMicrotask((function(){u(s,n)}))}(e);var n=l.get("*")||[],r=l.get(a)||[];[].concat(t(n),t(r)).forEach((function(t){var n=t.handler,r=t.keydown,o=t.keyup,u=t.key,c=t.splitValue;i(u).split(",").forEach((function(t){if(function(e,t){return e.split(t).length>1}(t,c)){var u=function(e,t){return i(e).split(t)}(t,c);p(u)&&h(n,r,o,e)}else p(t)&&h(n,r,o,e)}))}))}function h(e,t,n,r){var o=r.type;("keydown"===o&&t||"keyup"===o&&n)&&e.call(this,r)}l.set("*",[]),e.clearAll=function(){l.clear(),l.set("*",[]),a="default",d()},e.deleteScope=function(e){"*"!==e&&(l.delete(e),a="default")},e.getScope=function(){return a},e.setScope=function(e){if(!o(e))throw new Error("scope must be string");a=e},e.subscribe=function(e,t,n){if(!o(e))throw new Error("key must be string");if("function"!=typeof t)throw new Error("handler must be function");var r=e,i="default",c="+",a=!1,s=!1;o(n)?i=n:function(e){return"[object Object]"===Object.prototype.toString.call(e)}(n)&&Object.keys(n).forEach((function(e){"scope"===e&&(i=n[e]),"splitValue"===e&&(c=n[e]),"keydown"===e&&(a=!0),"keyup"===e&&(s=!0)})),a||s||(a=!0),f&&(f=!1,document.addEventListener("keydown",y),document.addEventListener("keyup",y),window.addEventListener("focus",d),window.addEventListener("blur",d)),l.has(i)||l.set(i,[]);var p=l.get(i),h={handler:t,key:r,splitValue:c,keydown:a,keyup:s};return p.push(h),function(){var e=l.get(i);e&&u(e,h)}},Object.defineProperty(e,"__esModule",{value:!0})}));
