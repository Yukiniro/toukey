"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var e=require("bittydash");function t(e){return function(e){if(Array.isArray(e))return r(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||function(e,t){if(!e)return;if("string"==typeof e)return r(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return r(e,t)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function r(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function n(e){switch(e){case"ctrl":return"Control";case"space":return" ";case"left":return"ArrowLeft";case"right":return"ArrowRight";case"up":return"ArrowUp";case"bottom":return"ArrowBottom";default:return e}}function o(e){return e.replace(/\s+/g,"")}function u(e){return e.toLowerCase()}var i="default",a=!0,c=[],s=new Map;function f(e){return Array.isArray(e)?u(e.map((function(e){return n(e)})).sort().join(""))===u(c.join("")):1===c.length&&u(c[0])===u(n(e))}function l(){c.length=0}function p(r){!function(t){var r=t.type,n=t.key,o=t.repeat;"keydown"!==r||o||c.push(n);"keyup"===r&&queueMicrotask((function(){e.remove(c,n)}))}(r);var n=s.get("*")||[],u=s.get(i)||[];[].concat(t(n),t(u)).forEach((function(e){var t=e.handler,n=e.keydown,u=e.keyup,i=e.key,a=e.splitValue;o(i).split(",").forEach((function(e){if(function(e,t){return e.split(t).length>1}(e,a)){var i=function(e,t){return o(e).split(t)}(e,a);f(i)&&d(t,n,u,r)}else f(e)&&d(t,n,u,r)}))}))}function d(e,t,r,n){var o=n.type;("keydown"===o&&t||"keyup"===o&&r)&&e.call(this,n)}s.set("*",[]),exports.clearAll=function(){s.clear(),s.set("*",[]),i="default",l()},exports.deleteScope=function(e){"*"!==e&&(s.delete(e),i="default")},exports.getScope=function(){return i},exports.setScope=function(t){if(!e.isString(t))throw new Error("scope must be string");i=t},exports.subscribe=function(t,r,n){if(!e.isString(t))throw new Error("key must be string");if(!e.isFunction(r))throw new Error("handler must be function");var o=t,u="default",i="+",c=!1,f=!1;e.isString(n)?u=n:e.isObject(n)&&Object.keys(n).forEach((function(e){"scope"===e&&(u=n[e]),"splitValue"===e&&(i=n[e]),"keydown"===e&&(c=!0),"keyup"===e&&(f=!0)})),c||f||(c=!0),a&&(a=!1,document.addEventListener("keydown",p),document.addEventListener("keyup",p),window.addEventListener("focus",l),window.addEventListener("blur",l)),s.has(u)||s.set(u,[]);var d=s.get(u),y={handler:r,key:o,splitValue:i,keydown:c,keyup:f};return d.push(y),function(){var t=s.get(u);t&&e.remove(t,y)}};
